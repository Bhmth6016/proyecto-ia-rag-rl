#!/usr/bin/env python3
"""
Reentrenamiento RLHF directo y forzado
"""

import sys
from pathlib import Path

sys.path.append(str(Path(__file__).parent))

def force_direct_rlhf():
    """Reentrenamiento RLHF directo"""
    
    print("ğŸ¯ REENTRENAMIENTO RLHF DIRECTO")
    print("=" * 50)
    
    try:
        # Importar el trainer directamente
        from src.core.rag.advanced.trainer import RLHFTrainer
        
        print("ğŸ¤– Cargando RLHFTrainer...")
        trainer = RLHFTrainer()
        
        # Definir rutas de feedback
        feedback_dir = Path("data/feedback")
        failed_log = feedback_dir / "failed_queries.log"
        success_log = feedback_dir / "success_queries.log"
        
        print("ğŸ“Š Preparando dataset desde logs...")
        dataset = trainer.prepare_rlhf_dataset_from_logs(failed_log, success_log)
        
        print(f"ğŸ“ Dataset preparado: {len(dataset)} ejemplos")
        
        if len(dataset) >= 3:  # MÃ­nimo requerido
            print("ğŸ‹ï¸ Iniciando entrenamiento...")
            trainer.train(dataset)
            print("ğŸ‰ ENTRENAMIENTO RLHF COMPLETADO")
        else:
            print(f"âš ï¸ Dataset insuficiente: {len(dataset)}/3 ejemplos")
            
    except Exception as e:
        print(f"âŒ Error: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    force_direct_rlhf()